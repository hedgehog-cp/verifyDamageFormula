- [赤仮](#赤仮)
  - [概説](#概説)
  - [導入方法](#導入方法)
  - [起動方法](#起動方法)
  - [データ出力](#データ出力)
    - [フィルタ](#フィルタ)
    - [Google Drive パソコン版の利用](#google-drive-パソコン版の利用)
  - [既知のバグ](#既知のバグ)
  - [後継](#後継)

# 赤仮

## 概説

- [のらたこ氏が開発している。](https://github.com/noratako5/logbook)
- 戦闘データの収集に用いる。

## 導入方法

Java で書かれているから、Java を動かすための環境をインストールする必要がある。
導入方法は、これまでに幾度となく解説されてきたからそれらに任せる。以下のいずれかを参照されたい。

- [艦これ検証 Wiki](https://kancolle.fandom.com/ja/wiki/データ収集ツール導入手順)
- 艦これツール wiki
  - [航海日誌拡張版](https://wikiwiki.jp/kancolletool/航海日誌拡張版)
  - [ツール提携](https://wikiwiki.jp/kancolletool/interop)
- [艦これのダメージ検証 TIPS](https://twitter.com/CC_jabberwock/status/1460957949413986304)

## 起動方法

多くの場合、赤仮をこれ単体で利用することは少ない。74 式電波観測儀などと併用することだろう。Sniffer とも併用する場合もある。艦これを始めるときにこれらのツール N 個を全て起動するために N 回起動するコマンドを与えることは避けたい。そこで、ここでは Windows 環境であることを仮定して BAT ファイルを利用した、複数ツールを一挙に起動する方法を例示する。

**74 式電波観測儀を起動して、赤仮を起動する** [参照](https://twitter.com/hedgehog_hasira/status/1592221402467532800)

```bat
cd C:\PATH\TO\ElectronicObserver\
start ElectronicObserver.exe

cd C:\PATH\TO\logbook\
start "" "logbook.exe" -jar

exit
```

**Suniffer を起動して、74 式電波観測儀を起動して、赤仮を起動する** [参照](https://twitter.com/Camellia_bb/status/1593672911042535424)

```bat
pushd C:\PATH\TO\KancolleSniffer\
START "" "KancolleSniffer.exe"
popd

pushd C:\PATH\TO\ElectronicObserver\
START "" "ElectronicObserver.exe"
popd

pushd C:\PATH\TO\logbook\
START "" "logbook4G.exe" -jar
popd
```

BAT ファイルを利用するには、以下の手順に従う。

1. メモ帳などのテキストエディタを開く
2. 上記ソースコード例にならって、コードを記述する
   - BAT ファイルの詳しい文法などについては [google 先生に尋ねよ](https://www.google.com/)
3. 拡張子を`.bat`として保存する
4. ダブルクリックなどで実行する

ここでいくつかの注意点がある

- これらのソースコードは、ロケールが日本ならば、Shift-JIS でエンコードされている必要がある。
- 74 式が EN などの派生の場合、フォルダ名が例とは異なるだろうから、適切に置換されたい。
- ツールのバージョン変更に伴い、フォルダやファイルの末尾が変更される場合がある。ワイルドカード\*を用いるとよいだろう。
- 以上のコードはあくまでも例であるため、あなたの環境では期待する動作を示さない場合がある。

## データ出力

戦闘データは CSV データとして出力できる。`ウィンドウ -> コマンド -> 戦闘報告書`より詳細な形式を選択できる。大別して次の 5 種がある。

1. **フィルタ適用 CSV 保存**
2. **赤仮**が前置されていない。戦闘後に関するデータが存在せず軽量だ。航空機の搭載数を知る必要が**ない**場合に利用できる。
   - 砲撃戦
   - 夜戦
   - 雷撃戦
3. **赤仮が前置されている。**戦闘後に関するデータが存在する。航空機の搭載数を知る必要が**ある**場合に利用する。
   - 赤仮砲撃戦
   - 赤仮夜戦
   - 赤仮雷撃戦
4. **EX が後置されている。**戦闘後に関するデータと、戦闘に直接参加しない艦のデータが存在する。とても重い。ふつう、利用しない。
   - 赤仮砲撃戦 EX
   - 赤仮夜戦 EX
   - 赤仮雷撃戦 EX
5. その他

1 について、`.hjson`という拡張子のファイルを用いて、フィルタを予め任意に記述しておき、これに従って出力できる。
フィルタの詳細は、`logbook/filter/フィルタ説明書.txt`や[フィルタ](#フィルタ)を参照されたい。
このフィルタを用いてデータを出力する際、その出力フォルダは、そのとき利用した`.hjson`ファイルと同じとなる。
ファイル名も同じだ。`filter.hjson`を用いたならば、`filter.csv`として保存される。
`filter`なぞという具体性のない名前ではなく、`陸軍歩兵部隊_改修効果`のような名前がよいだろう。

2~5 について、ここでは詳しく説明しない。表示される GUI に従って適切にフィルタリングして出力されたい。
CSV データ出力後は、ダメージ検証用スプレに import するか、クリップボードを介してコピペする。

2~5 のいずれの場合でも、出力された CSV データは、ロケールが日本ならば Shift-JIS でエンコードされているはずだ。
しかし、ユーザは気にしなくてもよい。

- クリップボードは優秀なので、クリップボードを介してダメージ検証用スプレに入力する際に勝手に変換してくれる。気にしなくてよい。
- Google spreadsheet の import も優秀だ。同様にエンコードは気にしなくてよい。そのはずだ。
- GAS を用いた import は難しい。明示的に UTF-8 に変換しなければならない。ユーザは気にしなくてよい。

### フィルタ

まず`logbook/filter/フィルタ説明書.txt`を参照されたい。

フィルタの拡張子は`.hjson`だ。これは JSON の拡張で、コメントが許可されている。マイナーな拡張子だ。JSON with Comments とは似て非なるものだ。
しかし、VSCode などで`.hjson`を編集するならば、メジャーな JSON with Comments であると騙して編集することもできる。
[vdf リポジトリ](https://github.com/hedgehog-cp/verifyDamageFormula)の`logbook/filter`が参考になるだろう。
ここにはよく使うフィルタの例を置いてもいるから使われたい。

### Google Drive パソコン版の利用

Google Drive にはパソコン版がある。
`Google Drive パソコン版/logbook/filter/filter.hjson`として`filter.hjson`を参照すれば、同じ場所に CSV データが出力される。
ダメージ検証では、Goolge spreadsheet を利用するから、Google Drive に保存しておくと都合がいい。
以下の手順に従って、ダメージ検証用スプレに CSV データを入力できる。

1. Google Drive でフォルダ F を作成する。
   - F は実際の検証内容に即した名前であるべきだ。
2. ダメージ検証用スプレ のコピーをフォルダ F にとる。
3. フォルダ F に、任意のフィルタを記述した`filter.hjson`をおく。
   - この`.hjson`ファイルの名前も、実際の検証内容に即した名前であるべきだ。
4. 赤仮で`ウィンドウ -> コマンド -> 戦闘報告書 -> フィルタ適用CSV保存`より`filter.hsjon`を参照してデータを出力･保存する。
5. ダメージ検証用スプレ で、上部メニューバーより(スクリプトの実行を許可して)import スクリプトを実行する。

このとき、Google Drive のフォルダ･ファイル構造は以下のようになっているはずだ。

```
フォルダ F
 |-ダメージ検証用スプレ.gsheet
 |-filter.hjson
 |-filter.csv
```

なお、このスクリプトは ダメージ検証用スプレ改 ver3.2.3 から利用できる。

## 既知のバグ

少なくとも以下のバグが確認されている。

- 雷撃戦のデータにおいて、残耐久を正しく追跡しない。
- 艦隊特殊攻撃のデータにおいて、砲撃順序を正しく出力しない。

## 後継

赤仮の開発者は 1 年以上その姿を現していない。したがって、[既知のバグ](#既知のバグ)が修正される見込みがない。

ある人物が保守を行っているらしいが、ある事情に基づき、ここでは詳細を述べない。少なくとも保守が続いていることだけを明言する。
