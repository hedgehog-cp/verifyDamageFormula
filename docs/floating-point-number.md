- [浮動小数点数](#浮動小数点数)
  - [誤差](#誤差)
  - [数値丸め](#数値丸め)
    - [床関数](#床関数)

# 浮動小数点数

実数を有限桁のビットで表現する方法のひとつに浮動小数点数がある。
今日において最も広く普及している規格は ISO/IEC/IEEE 60559(IEEE 754)だ。
IEEE754 では、用いるビット数別に 以下の規格が定められている。

- binary32 (単精度浮動小数点数)
- binary64 (倍精度浮動小数点数)
- binary128 (四倍精度浮動小数点数)

ふつう、特記なしに浮動小数点数といえば IEEE754 binary64 を指す。
IEEE754 binary64 は十進小数を表すとき、 およそ 15.95 桁の精度で表す。

<!-- ここでは IEEE754 binary64 に準拠した計算が正しいとする。 -->

## 誤差

浮動小数点数は実数を正確に表現できない。
これは、たとえば$\dfrac{1}{3}$を正確に有限桁の十進小数で書けないことと同様だ。

なお、浮動小数点数は 2 値のビットで表すため基数は 2 であり、$\dfrac{1}{10}$も正確に表現できない。

$\dfrac{1}{10}=0.00011001100110011\cdots_{2}$

他にも有名な例として、次がある。

$0.1+0.2\neq0.3$

> 浮動小数点演算によって得られた結果と真値に大きな差が生じることは非常に稀であり、つねに心配するにはあまりにも稀であるが、だからといって無視できるほど稀なわけではない。 ――W. M. Kahan

## 数値丸め

### 床関数

任意の実数$x$に対して、$x$を越えない最大の整数$\lfloor x \rfloor$を求める。

Google spreadsheet において、標準で用意されている組み込み関数`int(･)`、`floor(･)`などでは 正しく床関数をとれない。
これらの関数は 15 桁の精度に丸めてから期待する計算を行う。

$N\in\N, 0< \epsilon \ll N$に対して, $x\in[N-\epsilon, N+1-\epsilon)$なる$x$は, ある一部の関数で作用されるとき, 作用の直前に $N$ へと丸められる.
この丸めはおそらく 16 桁目を四捨五入している。

```
   N-2        N-1         N         N+1        N+2
----|----------|----------|----------|----------|---->
                         ^          ^
                         [-----------)
                        N-ε       N+1-ε
```

およそ 15.95 桁精度のままで床関数をとるには、15 桁への丸め条件を考慮すればよい。
ある一部の関数は 15.95 桁の精度のままで関数を作用するため、これらの関数を利用する。
以下でこれを達成できる。

```
=int(x) - not(gestep(x, int(x)))
```

この数式では実引数を与える箇所が 3 つあり、使い勝手が悪い。`lambda`や`let`を利用することで使いやすくできる。

```
=lambda(x, int(x) - not(gestep(x, int(x))))( /* ここに実引数を与える */ )
```

```
=let(x, /* ここに実引数を与える */, int(x) - not(gestep(x, int(x))))
```

```
=let(myFunc, lambda(x, int(x) - not(gestep(x, int(x)))), myFunc(/* ここに実引数を与える */))
```
