# Google spreadsheet

Google spreadsheet は次の点で優れる.

- データの共有
- 計算式の透明性
- 計算式の書き換えが容易で, 高速な実装が可能

しかし, 計算速度が非常に遅く, ビッグデータの処理, 複雑な計算, 高次元配列の計算には不向きだ.
これらの計算を目的に Google spreadsheet を選択してはいけない.
Google spreadsheet を選択してよい条件は, 計算が単純で, 計算するデータ数が多くなく, 二次元までの配列計算で, プログラミングに明るくない人たちともデータや計算結果を共有したいときだ.

# 条件分岐

条件分岐には`if()`を使う.
ただし, `if()`が提供するのは解釈と分岐であり, 比較ではない.
次の式は`true`をセルに返す.

```js
=(0 < 1)
```

`true`は数値計算において`1`のように振る舞う.
そのため, 次の式は`10`をセルに返す.

```js
=true * 10
```

`false`は数値計算において`0`のように振る舞う.
そのため, 次の式は`0`をセルに返す.

```js
=false * 10
```

以上をまとめると次の要件は以下のように書ける.

- x が正のとき, `2`をセルに返す
- そうでないとき, `1`をセルに返す

```js
=2 ^ (x > 0)
```

`if()`は解釈を提供する.
`if()`が第 1 引数を真と解釈すれば第 2 引数を評価し, 偽と解釈すれば第 3 引数を評価するかデフォルトの`false`をセルに返す.
`if()`は実数のうち`0`を偽と解釈し, これ以外を真と解釈する.
すなわち, 次の式は`42`をセルに返す.

```js
=if(len("生命、宇宙、そして万物についての究極の疑問の答え"), 42)
```

標準の比較演算子`<`, `>`, `=`などは数値を十進 15 桁程度に丸めてから比較演算を行う.
次の式は`false`をセルに返す.

```
=(1+1e-16)  > 1
```

分岐する条件は明確に記述すべきでない場合もある.
次の要件は以下のように書ける.

- `x` が `220` 以上のとき, `sqrt(x - 220) + 220` をセルに返す
- そうでないとき, `x`をセルに返す

```js
=iferror(
    sqrt(x - 220) + 220,
    x
)
```

または

```js
=min(x, 220) + sqrt(max(x - 220, 0))
```

# 包含検索

## 一次元配列 A に要素 a が含まれているかを, 完全一致検索で検証する.

```js
=isNumber(match(a, A, 0))
```
